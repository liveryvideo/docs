<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Livery Video Docs</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="description" content="Livery Video documentation." />
    <meta
      name="viewport"
      content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0"
    />

    <!-- Theme: Simple Dark -->
    <link
      rel="stylesheet"
      href="//cdn.jsdelivr.net/npm/docsify-themeable@0/dist/css/theme-simple-dark.css"
    />

    <style>
      :root {
        /* Change the theme color hue */
        --theme-hue: 300;
      }
    </style>
  </head>
  <body>
    <div id="app"></div>

    <script>
      const dev = window.location.origin === 'http://127.0.0.1:8080';

      const fetchText = (url) =>
        fetch(url, {
          // From local dev server don't use headers to work around CORS
          headers: dev ? {} : window.$docsify.requestHeaders,
        }).then((response) => response.text());

      const deprecated = (path) =>
        `# Deprecated page\nPlease use the following path instead: [${path}](${path})`;

      window.$docsify = {
        alias: {
          '/.*/_navbar.md': '/_navbar.md',
        },
        auto2top: true,
        loadNavbar: true,
        logo: 'logo.png',
        maxLevel: 3,
        // TODO: Use this if we make nav bar too wide
        mergeNavbar: true,
        name: 'Livery Video Docs',
        nameLink: '/',
        relativePath: true,
        requestHeaders: {
          'cache-control': 'no-cache',
        },
        routerMode: 'history',
        routes: {
          // Local testing override
          '/npm/interactive-bridge/(.*)': (route, matched, next) => {
            let path = matched[1];
            if (path.endsWith('/')) {
              path += 'index';
            }
            fetchText(`http://127.0.0.1:60954/${path}.md`).then(next);
          },

          // Load markdown from one of our @liveryvideo/* NPM packages
          '/npm/(.*)': (route, matched, next) => {
            let path = matched[1];
            if (path.endsWith('/')) {
              path += 'index';
            }
            fetchText(
              `https://cdn.jsdelivr.net/npm/@liveryvideo/${path}.md`,
            ).then(next);
          },

          // Deprecated pages
          '/interactive-bridge-changelog': () =>
            deprecated('/npm/interactive-bridge/CHANGELOG'),
          '/interactive-sdk': () => deprecated('/interactive-bridge'),
          '/interactive-sdk-changelog': () =>
            deprecated('/npm/interactive-bridge/CHANGELOG'),
          '/web-player-changelog': () => deprecated('/npm/player/CHANGELOG'),
          '/web-sdk': () => deprecated('/web-player'),
          '/web-sdk-changelog': () => deprecated('/npm/player/CHANGELOG'),

          // Work around notFoundPage not working with routerMode history and server returning index.html instead of 404
          '.*': (route, matched, next) => {
            fetchText(`${route === '/' ? '/README' : route}.md`).then(
              (text) => {
                if (text.startsWith('<!DOCTYPE html>')) {
                  fetchText('_404.md').then(next);
                } else {
                  next(text);
                }
              },
            );
          },
        },
        search: {
          namespace: 'livery-video-docs',
          depth: 6,
        },
      };
    </script>

    <script src="//cdn.jsdelivr.net/npm/docsify/lib/docsify.min.js"></script>

    <!-- docsify-themeable (latest v0.x.x) -->
    <script src="//cdn.jsdelivr.net/npm/docsify-themeable@0"></script>

    <!-- https://docsify.js.org/#/plugins?id=full-text-search -->
    <script src="//cdn.jsdelivr.net/npm/docsify/lib/plugins/search.min.js"></script>

    <!-- https://docsify.js.org/#/plugins?id=copy-to-clipboard -->
    <script src="//cdn.jsdelivr.net/npm/docsify-copy-code"></script>

    <script src="//cdn.jsdelivr.net/npm/prismjs/components/prism-groovy.min.js"></script>
    <script src="//cdn.jsdelivr.net/npm/prismjs/components/prism-java.min.js"></script>
    <script src="//cdn.jsdelivr.net/npm/prismjs/components/prism-swift.min.js"></script>
    <script src="//cdn.jsdelivr.net/npm/prismjs/components/prism-json.min.js"></script>

    <!-- docsify-tabs (latest v1.x.x) -->
    <script src="//cdn.jsdelivr.net/npm/docsify-tabs@1"></script>

    <!-- docsify-mermaid, using v1.0.0 specifically because of https://github.com/Leward/mermaid-docsify/issues/31 -->
    <script src="//cdn.jsdelivr.net/npm/docsify-mermaid@1.0.0/dist/docsify-mermaid.js"></script>

    <script type="module">
      import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs';
      mermaid.initialize({ startOnLoad: true });
      window.mermaid = mermaid;
    </script>
  </body>
</html>
